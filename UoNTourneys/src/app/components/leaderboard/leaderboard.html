<div class="lb-page-container">
    <mat-card class="lb-header-card mat-elevation-z4">
    <mat-card-content>
        <div class="lb-header-top">
        <div>
            <h1>Leaderboard</h1>
            <p class="subtitle">
            FACEIT hub leaderboard with live points, wins and streaks.
            </p>
        </div>

        <mat-chip-set>
            <mat-chip color="primary" selected>
            <mat-icon>emoji_events</mat-icon>
            10 Mans · CS2
            </mat-chip>
        </mat-chip-set>
        </div>

        <form class="lb-form" (ngSubmit)="onReload()">
        <mat-form-field appearance="outline" class="lb-id-field">
            <mat-label>Leaderboard ID</mat-label>
            <input
            matInput
            [(ngModel)]="leaderboardId"
            name="leaderboardId"
            placeholder="692def172584a759a9bd3eed" />
        </mat-form-field>

        <button mat-raised-button color="accent" type="submit">
            <mat-icon>refresh</mat-icon>
            <span>Reload</span>
        </button>
        </form>

        <div class="lb-loading" *ngIf="loading">
        <mat-progress-spinner mode="indeterminate" diameter="48"></mat-progress-spinner>
        </div>

        <mat-card *ngIf="error" class="lb-error-card">
        <mat-icon color="warn">error_outline</mat-icon>
        <span>{{ error }}</span>
        </mat-card>
    </mat-card-content>
    </mat-card>


  <!-- META SUMMARY -->
  <mat-card *ngIf="data && !loading" class="lb-summary-card mat-elevation-z3">
    <mat-card-content>
      <div class="meta-left">
        <h2>{{ data.leaderboard.leaderboard_name }}</h2>
        <div class="meta-label">
          {{ data.leaderboard.game_id | uppercase }} · {{ data.leaderboard.region | uppercase }}
        </div>
      </div>

      <div class="meta-middle">
        <div class="meta-row">
          <span class="label">Status</span>
          <mat-chip
            [color]="data.leaderboard.status === 'ONGOING' ? 'primary' : ''"
            selected>
            <mat-icon *ngIf="data.leaderboard.status === 'ONGOING'">play_circle</mat-icon>
            {{ data.leaderboard.status }}
          </mat-chip>
        </div>
        <div class="meta-row">
          <span class="label">Min matches</span>
          <span class="value">{{ data.leaderboard.min_matches }}</span>
        </div>
      </div>

      <div class="meta-right">
        <div class="meta-row">
          <span class="label">Scoring</span>
          <span class="value">
            +{{ data.leaderboard.points_per_win }} W /
            {{ data.leaderboard.points_per_loss }} L /
            +{{ data.leaderboard.points_per_draw }} D
          </span>
        </div>
        <div class="meta-row">
          <span class="label">Starting ELO</span>
          <span class="value">{{ data.leaderboard.starting_points }}</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- TABLE -->
  <mat-card *ngIf="data && !loading" class="lb-table-card mat-elevation-z3">
    <mat-card-content>
      <table
        mat-table
        [dataSource]="data.items"
        class="lb-table mat-elevation-z1">

        <!-- Position -->
        <ng-container matColumnDef="position">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let row">
            <span class="pos" [ngClass]="'pos-' + row.position">
              {{ row.position }}
            </span>
          </td>
        </ng-container>

        <!-- Avatar (NEW COLUMN) -->
        <ng-container matColumnDef="avatar">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let row">
            <div class="avatar-wrapper">
              <img
                *ngIf="row.player.avatar"
                [src]="row.player.avatar"
                alt="{{ row.player.nickname }}"
                class="avatar" />
            </div>
          </td>
        </ng-container>

        <!-- Player -->
        <ng-container matColumnDef="player">
          <th mat-header-cell *matHeaderCellDef>Player</th>
          <td mat-cell *matCellDef="let row">
            <div class="player-cell">
              <div class="player-text">
                <div class="nickname">
                  <a
                    [href]="getFaceitUrl(row)"
                    target="_blank"
                    rel="noopener noreferrer">
                    {{ row.player.nickname }}
                  </a>
                </div>
                <div class="player-meta">
                  <span class="country" [matTooltip]="row.player.country | uppercase">
                    {{ row.player.country | uppercase }}
                  </span>
                  ·
                  <span>Lvl {{ row.player.skill_level }}</span>
                </div>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Points / ELO -->
        <ng-container matColumnDef="elo">
          <th mat-header-cell *matHeaderCellDef>Points</th>
          <td mat-cell *matCellDef="let row">
            {{ row.points }}
          </td>
        </ng-container>

        <!-- Played -->
        <ng-container matColumnDef="played">
          <th mat-header-cell *matHeaderCellDef>Played</th>
          <td mat-cell *matCellDef="let row">
            {{ row.played }}
          </td>
        </ng-container>

        <!-- Won -->
        <ng-container matColumnDef="won">
          <th mat-header-cell *matHeaderCellDef>W</th>
          <td mat-cell *matCellDef="let row">
            {{ row.won }}
          </td>
        </ng-container>

        <!-- Lost -->
        <ng-container matColumnDef="lost">
          <th mat-header-cell *matHeaderCellDef>L</th>
          <td mat-cell *matCellDef="let row">
            {{ row.lost }}
          </td>
        </ng-container>

        <!-- Win rate -->
        <ng-container matColumnDef="winrate">
          <th mat-header-cell *matHeaderCellDef>Win %</th>
          <td mat-cell *matCellDef="let row">
            {{ getWinRatePercent(row) | number:'1.0-0' }}%
          </td>
        </ng-container>

        <!-- Streak -->
        <ng-container matColumnDef="streak">
          <th mat-header-cell *matHeaderCellDef>Streak</th>
          <td mat-cell *matCellDef="let row">
            <span class="streak" *ngIf="row.current_streak > 0">
              W{{ row.current_streak }}
            </span>
            <span *ngIf="row.current_streak === 0">-</span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns; trackBy: trackByPlayer">
        </tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
